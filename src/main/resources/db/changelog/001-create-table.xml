<?xml version="1.0" encoding="UTF-8"?>
<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
                   xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
                   xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog
                   https://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-latest.xsd">

    <changeSet id="001-create-table" author="jilariation">

        <sql>DROP TABLE IF EXISTS service_schema.player_history;</sql>
        <sql>DROP SEQUENCE IF EXISTS service_schema.player_history_sequence;</sql>
        <sql>DROP SCHEMA IF EXISTS service_schema;</sql>

        <sql>DROP TABLE IF EXISTS entity_schema.transaction;</sql>
        <sql>DROP TABLE IF EXISTS entity_schema.player;</sql>
        <sql>DROP SEQUENCE IF EXISTS entity_schema.player_sequence;</sql>
        <sql>DROP SCHEMA IF EXISTS entity_schema;</sql>

        <createTable tableName="player">
            <column name="id" type="INT">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="name" type="VARCHAR(50)">
                <constraints nullable="false" unique="true"/>
            </column>
            <column name="password" type="VARCHAR(100)">
                <constraints nullable="false"/>
            </column>
            <column name="balance" type="INT">
                <constraints nullable="false" />
            </column>
        </createTable>
        <addDefaultValue tableName="player" columnName="balance" defaultValue="100"/>
        <sql>CREATE SEQUENCE player_sequence START 2;</sql>

        <createTable tableName="player_history">
            <column name="id" type="INT">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="player_id" type="INT">
                <constraints nullable="false" foreignKeyName="player_history_player_id_fkey" references="player(id)"/>
            </column>
            <column name="what_player_doing" type="VARCHAR(30)">
                <constraints nullable="false"/>
            </column>
        </createTable>
        <sql>CREATE SEQUENCE player_history_sequence START 2;</sql>

        <createTable tableName="transaction">
            <column name="id" type="INT">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="value" type="INT">
                <constraints nullable="false"/>
            </column>
            <column name="transaction_type" type="VARCHAR(15)">
                <constraints nullable="false"/>
            </column>
            <column name="player_id" type="INT">
                <constraints nullable="false" foreignKeyName="transaction_player_id_fkey" references="player(id)"/>
            </column>
        </createTable>

        <sql>CREATE SCHEMA entity_schema</sql>
        <sql>ALTER TABLE player SET SCHEMA entity_schema</sql>
        <sql>ALTER TABLE transaction SET SCHEMA entity_schema</sql>
        <sql>ALTER SEQUENCE player_sequence SET SCHEMA entity_schema </sql>

        <sql>CREATE SCHEMA service_schema</sql>
        <sql>ALTER TABLE player_history SET SCHEMA service_schema</sql>
        <sql>ALTER SEQUENCE player_history_sequence SET SCHEMA service_schema</sql>
    </changeSet>
</databaseChangeLog>